<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#222">
    <title>Jadwal Imsak & Berbuka</title>
    <style>
        :root {
            --bg: rgba(10, 10, 10, 0.9);
            --text: #fff;
            --primary: #ffcc00;
        }
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
        }
        .container {
            padding: 20px;
            max-width: 400px;
            margin: auto;
        }
        h1 { color: var(--primary); }
        select, button {
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
        }
        select { width: 100%; }
        button { background: var(--primary); color: #000; cursor: pointer; }
        .countdown { font-size: 1.5em; margin: 10px 0; }
        .dark-mode { position: fixed; bottom: 10px; right: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Jadwal Imsak & Berbuka</h1>
        <h2 id="jam"></h2>
        <p id="lokasi">Mendeteksi lokasi...</p>
        <select id="kota">
            <option value="" disabled selected>Pilih Kota</option>
        </select>
        <button onclick="loadJadwal()">Lihat Jadwal</button>
        
        <h3>Jadwal Sholat</h3>
        <p>Imsak: <span id="imsak">-</span></p>
        <p>Subuh: <span id="subuh">-</span></p>
        <p>Zuhur: <span id="zuhur">-</span></p>
        <p>Ashar: <span id="ashar">-</span></p>
        <p>Maghrib (Berbuka): <span id="maghrib">-</span></p>
        <p>Isya: <span id="isya">-</span></p>

        <h3>Countdown</h3>
        <p class="countdown">Imsak: <span id="countdownImsak">-</span></p>
        <p class="countdown">Berbuka: <span id="countdownBerbuka">-</span></p>
        
        <button onclick="setNotifikasi()">Set Notifikasi</button>
    </div>

    <button class="dark-mode" onclick="toggleDarkMode()">ðŸŒ™</button>

    <script>
        let jadwal = {};
        
        function updateJam() {
            const now = new Date();
            document.getElementById('jam').innerText = now.toLocaleTimeString('id-ID');
        }
        setInterval(updateJam, 1000);

        async function getJadwal(lat, lon) {
            const res = await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=2`);
            const data = await res.json();
            return data.data.timings;
        }

        async function loadJadwal() {
            let kota = document.getElementById("kota").value;
            if (!kota) return alert("Pilih kota dulu!");

            let [lat, lon] = kota.split(",");
            jadwal = await getJadwal(lat, lon);
            document.getElementById("imsak").innerText = jadwal.Imsak;
            document.getElementById("subuh").innerText = jadwal.Fajr;
            document.getElementById("zuhur").innerText = jadwal.Dhuhr;
            document.getElementById("ashar").innerText = jadwal.Asr;
            document.getElementById("maghrib").innerText = jadwal.Maghrib;
            document.getElementById("isya").innerText = jadwal.Isha;
        }

        function updateCountdown() {
            if (!jadwal.Imsak || !jadwal.Maghrib) return;
            const now = new Date();
            const imsakTime = new Date(now.toDateString() + " " + jadwal.Imsak);
            const maghribTime = new Date(now.toDateString() + " " + jadwal.Maghrib);
            
            const diffImsak = imsakTime - now;
            const diffMaghrib = maghribTime - now;
            
            document.getElementById("countdownImsak").innerText = diffImsak > 0 ? Math.floor(diffImsak / 60000) + " menit lagi" : "Waktu Imsak!";
            document.getElementById("countdownBerbuka").innerText = diffMaghrib > 0 ? Math.floor(diffMaghrib / 60000) + " menit lagi" : "Waktunya berbuka!";
        }
        setInterval(updateCountdown, 1000);

        function setNotifikasi() {
            if (!("Notification" in window)) return alert("Browser tidak mendukung notifikasi.");
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    new Notification("Pengingat Imsak & Berbuka", {
                        body: "Jangan lupa sahur & berbuka!",
                        icon: "https://via.placeholder.com/128"
                    });
                }
            });
        }

        function toggleDarkMode() {
            document.body.style.background = document.body.style.background === "white" ? "var(--bg)" : "white";
            document.body.style.color = document.body.style.color === "black" ? "var(--text)" : "black";
        }

        async function detectLocation() {
            navigator.geolocation.getCurrentPosition(async pos => {
                let lat = pos.coords.latitude;
                let lon = pos.coords.longitude;
                let res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                let data = await res.json();
                document.getElementById("lokasi").innerText = "Lokasi: " + data.address.city;
                document.getElementById("kota").innerHTML = `<option value="${lat},${lon}" selected>${data.address.city}</option>`;
                loadJadwal();
            }, () => alert("Gagal mendeteksi lokasi!"));
        }
        detectLocation();
    </script>
</body>
</html>
